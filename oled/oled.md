# OLED驱动开发笔记

## 硬件信息
显示屏尺寸: 0.96寸 分辨率: 128x64像素 驱动芯片: SSD1306 通信方式: I2C 默认地址: 0x78

## 基本原理
OLED驱动开发的基本原理是向芯片发送命令和数据： 命令模式: 0x00 数据模式: 0x01

## 命令宏定义
```c
#define ON 0xAF
#define OFF 0xAE
// 其他命令宏可以根据需要添加
```

## 初始化函数
简单初始化模式：---也可以全面地写配置更详细的参数
```c
OLED_SendCmd(0xAE);  // 关闭显示
OLED_SendCmd(0x8D);  // 电荷泵设置
OLED_SendCmd(0x14);  // 启用电荷泵
OLED_SendCmd(0xAF);  // 开启显示
```

## I2C通信函数
接下来包装一下i2c驱动，写出发送命令和数据函数
通信流程：开始信号-->发送地址-->等待ACK-->发送通信模式（命令/数据）-->等待ACK-->发送命令/数据-->等待ACK—>结束信号
### 发送命令函数
```c
void OLED_SendCmd(uint8_t cmd) {
    I2C_Signal_Start();
    I2C_Byte_Send(0x78);     // 发送设备地址
    I2C_ACK_Wait();
    I2C_Byte_Send(0x00);     // 命令模式
    I2C_ACK_Wait();
    I2C_Byte_Send(cmd);      // 发送命令
    I2C_ACK_Wait();
    I2C_Signal_Stop();
}
```

## 显示原理
OLED使用页寻址模式，显存结构如下：

| 地址 | 列1 | 列x | 列y | 列128 |
|------|-----|-----|-----|-------|
| 页1  | 一个位置1字节 | 字节最低位为|这一页最开始|的一行 |
| 页x  |  | 字节最高位为|这一页最后|的一行 |
| 页8  |  | 一页有8行 | 总共8页 |  |

## 画点函数
```c

    uint8_t page = y / 8;
    uint8_t row = y % 8;
    uint8_t data = 0x01 << row;
    
    OLED_SendCmd(0xB0 + page);       // 设置页地址
    OLED_SendCmd(0x10 + (x >> 4));  // 设置列地址高4位
    OLED_SendCmd(0x00 + (x & 0x0F)); // 设置列地址低4位
    OLED_SendData(data);

```
学会在屏幕上画一个点以后，就能在屏幕上画一个圆、画一张图、或者取字模，往屏幕上写字。当然如果嫌一个一个点画很麻烦，可以现在芯片上开辟一块存储空间作为虚拟显存
```c
uint8_t OLED_RAM[128][8];  // 虚拟显存
```
先在虚拟显存上绘制好现实的内容，再直接一次性发送虚拟显存中的所有数据，这种方法能够减小通信开销，但是需要额外的存储空间。
命令（页地址（0xB0+page（0-7)））-->命令（列地址高4位（0x10+高4位））-->命令（列地址低4位（0x00+低4位））-->8x128个数据（8个像素对应8个比特）。


## 其他命令
如果想要更高级的使用oled显示屏，可以在网上查找更多的命令比如：亮度、对比度、时钟、偏移、正/反显、寻址方式等等高级玩法。这里给出一些命令。
| 指令 | 值 | 作用 | 说明 |
|------|----|------|------|
| 关闭显示 | 0xAE | 关闭OLED显示 | 在初始化过程中，先关闭显示，避免在配置过程中出现乱码或闪烁 |
| 设置显示时钟分频比 | 0xD5 | 设置显示时钟的分频比和振荡器频率 | 0x80 是默认值，表示分频比为1，振荡器频率为最大值 |
| 设置多路复用比率 | 0xA8 | 设置COM引脚的数量 | 0x3F 表示使用64个COM引脚（适用于128x64分辨率的OLED） |
| 设置显示偏移 | 0xD3 | 设置显示起始行的偏移量 | 0x00 表示没有偏移，显示从第0行开始 |
| 设置显示开始行 | 0x40 | 设置显示起始行 | 0x00 表示从第0行开始显示 |
| 设置电荷泵 | 0x8D | 启用电荷泵 | 0x14 表示启用电荷泵（必须启用，否则屏幕无法正常显示） |
| 设置内存地址模式 | 0x20 | 设置内存地址模式 | 0x00 表示使用水平地址模式（Horizontal Addressing Mode） |
| 设置段重映射 | 0xA0 | 设置段重映射 | 0x01 表示将段映射反向（即列127映射到SEG0） |
| 设置COM输出扫描方向 | 0xC8 | 设置COM输出扫描方向 | 0xC8 表示从COM63扫描到COM0（反向扫描） |
| 设置COM引脚硬件配置 | 0xDA | 设置COM引脚的硬件配置 | 0x12 表示使用顺序COM引脚配置，并禁用左右COM引脚交换（适用于128x64分辨率） |
| 设置对比度控制 | 0x81 | 设置显示对比度 | 0xCF 是对比度值（范围：0x00~0xFF），值越大，显示越亮 |
| 设置预充电周期 | 0xD9 | 设置预充电周期 | 0xF1 表示预充电周期为15个DCLK，放电周期为1个DCLK |
| 设置VCOMH电压倍率 | 0xDB | 设置VCOMH电压倍率 | 0x40 表示VCOMH电压为0.77 * VCC |
| 开启显示 | 0xAF | 开启OLED显示 | 在初始化完成后，必须发送该命令以显示内容 |


